
<div class="h-full flex flex-col bg-gray-900">
  @if (patient(); as p) {
    <!-- Header -->
    <div class="flex items-center p-4 border-b border-gray-700 bg-gray-800">
      <img [src]="p.avatarUrl" alt="Avatar" class="w-10 h-10 rounded-full mr-4">
      <div>
        <h2 class="text-lg font-bold text-white">{{ p.name }}</h2>
        <p class="text-sm text-gray-400">{{ p.phone }}</p>
      </div>
    </div>

    <!-- Chat Messages -->
    <div #chatContainer class="flex-grow p-6 overflow-y-auto">
      <div class="flex flex-col space-y-4">
        @for(message of p.chatHistory; track message.timestamp) {
          <div class="flex" [class.justify-end]="message.sender === 'user'" [class.justify-start]="message.sender !== 'user'">
            <div class="max-w-xs lg:max-w-md p-3 rounded-lg" 
              [class.bg-teal-600]="message.sender === 'user'"
              [class.bg-gray-700]="message.sender !== 'user'"
              [class.text-white]="message.sender === 'user'">
              <p class="text-sm">{{ message.text }}</p>
              <p class="text-xs mt-1 text-gray-400 text-right" [class.text-teal-200]="message.sender === 'user'">{{ message.timestamp | date:'shortTime' }}</p>
            </div>
          </div>
        }
      </div>
       @if (isGenerating()) {
        <div class="flex justify-start mt-4">
            <div class="max-w-xs lg:max-w-md p-3 rounded-lg bg-gray-700">
              <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.2s]"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-pulse [animation-delay:0.4s]"></div>
              </div>
            </div>
        </div>
      }
    </div>

    <!-- Message Input -->
    <div class="p-4 border-t border-gray-700 bg-gray-800">
      <form (submit)="sendMessage()" class="flex items-center space-x-4">
        <input 
          type="text" 
          placeholder="Escribe un mensaje..."
          [(ngModel)]="newMessage"
          name="newMessage"
          class="flex-grow bg-gray-700 border border-gray-600 rounded-full py-3 px-6 text-white focus:outline-none focus:ring-2 focus:ring-teal-500"
          [disabled]="isGenerating()">
        <button 
          type="submit" 
          class="bg-teal-600 text-white rounded-full p-3 hover:bg-teal-500 transition-colors duration-200 disabled:bg-gray-500 disabled:cursor-not-allowed"
          [disabled]="!newMessage().trim() || isGenerating()">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" /></svg>
        </button>
      </form>
    </div>

  } @else {
    <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-24 h-24 mb-4 text-gray-600" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM8.547 8.294a.75.75 0 011.052-.222l4.25 2.5a.75.75 0 010 1.356l-4.25 2.5a.75.75 0 01-1.274-.678V8.516a.75.75 0 01.222-.522z" /></svg>
        <h2 class="text-2xl font-semibold">Bienvenido al Gestor de Pacientes</h2>
        <p class="mt-2 max-w-sm">Selecciona un paciente de la lista de la izquierda para ver su conversaci√≥n e interactuar con el asistente de IA.</p>
    </div>
  }
</div>